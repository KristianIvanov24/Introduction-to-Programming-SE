# Streams. File streams. (Потоци. Файлови потоци.)


## Увод
При разработката на реални проекти в C++ често се налага да **запазваме данни между различни изпълнения** на програмата. Това постигаме чрез работа с файлове.

Работата с файлове е много подобна на работата с конзолата, с някои нови подробности:
- `cin` чете от конзолата -> `ifstream` чете от файл
- `cout` пише на конзолата -> `ofstream` пише във файл

За да работим с файлове, трябва да включим библиотеката:
```c++
#include <fstream>
```

---

## 1. Четене от файлове (`ifstream`)

### 1.1. Отваряне на файл за четене

```c++
std::ifstream file("data.txt");

// ВАЖНО: Винаги проверявайте дали файлът е отворен успешно!
if (!file.is_open()) {
    std::cout << "Couldn't open file." << std::endl;
    return;
}
```

**Какво се случва ако файлът не съществува?**
- `is_open()` ще върне `false`
- Не можем да четем от файла
- Трябва да обработим грешката (да излезем от функцията, да прекратим програмата и т.н.)

---

### 1.2. Методи за четене от файл

#### `file >> variable` - Форматирано четене
Пропуска **whitespace символи** (интервал, нов ред, табулация) и след това чете данни за съответния тип:

```c++
int age;
double grade;
file >> age;    // Прочита число
file >> grade;  // Прочита дробно число
```

**Пример със файл:**
```
25 5.5
```
```c++
int number;
double grade;
file >> number >> grade;  // number = 25, grade = 5.5
```

---

#### `file.getline(buffer, size, separator)` - Четене на ред

Функцията има два overload-a.

Основният е:
file.getline(char*, int, char) - чете и записва в буфера до разделителя (него го подминава, но не го записва)

file.getline(char*, int) - извиква предния с разделител '\n'


Това е **най-важният метод** за четене на текст от файлове!

**Параметри:**
- `buffer` - масивът, в който да запишем прочетеното
- `size` - максималният размер на буфера
- `separator` - до кой символ да четем (по подразбиране `'\n'`)

**Пример: Четене на цял ред**
```c++
char name[100];
file.getline(name, 100);  // Чете до '\n' (нов ред)
// Когато срещне '\n' слага терминираща нула в низа и премества указателя на следващия ред.
```

Ако файлът е:
```
Иван Иванов
```
То `name` ще съдържа: `"Иван Иванов"`

---

#### `file.get()` - Четене на един символ
```c++
char ch = file.get();  // Прочита един символ
```

---

#### `file.ignore()` - Прескачане на символи
```c++
file.ignore();              // Прескача 1 символ
file.ignore(100, '\n');     // Прескача до 100 символа ИЛИ до '\n'
```

---

### 1.3. Проверка за край на файла

```c++
while (!file.eof()) {
    // четем данни
}
```

Или по-добрият начин:
```c++
char name[100];
while (file.getline(name, 100)) {
    // file.getline() връща false при край на файла
}
```

---

### 1.4. Затваряне на файл

```c++
file.close();
```

**Добра практика:** Винаги затваряйте файловете когато приключите работа с тях!

---

## 2. Писане във файлове (`ofstream`)

### 2.1. Отваряне на файл за писане

```c++
std::ofstream file("output.txt");

if (!file.is_open()) {
    std::cout << "Грешка при създаване на файла!" << std::endl;
    return;
}
```

**ВНИМАНИЕ:** Ако файлът съществува, той ще бъде **изтрит** и записан наново!

---

### 2.2. Методи за писане във файл

#### `file << data` - Форматирано писане

```c++
file << "Име: " << name << std::endl;
file << "Оценка: " << grade << std::endl;
```

Резултат във файла:
```
Име: Иван Иванов
Оценка: 5.5
```

---

#### `file.put(char)` - Писане на един символ

```c++
file.put('A');
file.put('\n');
```

---

### 2.3. Затваряне на файл

```c++
file.close();
```

---

## 3. Режими на отваряне на файлове

По подразбиране:
- `ifstream` отваря за **четене**
- `ofstream` отваря за **писане** (изтрива съдържанието)

Можем да зададем специални режими:

```c++
// Добавяне в края на файла (без да изтрива съдържанието)
std::ofstream file("log.txt", std::ios::app);

// Отваряне за четене И писане
std::fstream file("data.txt", std::ios::in | std::ios::out);
```

**Често използвани режими:**
- `std::ios::app` - append (добавяне в края)
- `std::ios::in` - четене
- `std::ios::out` - писане
---

## 4. Пример с ученици и оценки

## Основни правила

1. **Отваряйте** файла с `ifstream` (четене) или `ofstream` (писане)
2. **Проверявайте** дали файлът е отворен (`is_open()`)
3. **Четете/Пишете** с подходящите методи (`getline`, `>>`, `<<`)
4. **Затваряйте** файла с `close()`

Credits for the readme: https://github.com/AlexMandev